blueprint:
  name: Hue Tap Dial Preset
  description: >
    Hue Tap Dial Preset
  domain: automation

  input:
    mqtt_device:
      name: MQTT Button Device
      description: The MQTT device that sends button actions
      selector:
        device:
          integration: mqtt

    light_target:
      name: Světlo
      selector:
        entity:
          domain: light

    button_2_press:
      name: Button 2
      default: []
      selector:
        action: {}

    button_3_press:
      name: Button 3
      default: []
      selector:
        action: {}

    button_4_press:
      name: Button 4
      default: []
      selector:
        action: {}

    brightness_step:
      name: Procenta tlumení světla (%)
      description: Percentage step for brightness up/down
      default: 15
      selector:
        number:
          min: 1
          max: 50
          unit_of_measurement: "%"

    transition_time:
      name: Přechod světla (sekundy)
      default: 0.5
      selector:
        number:
          min: 0
          max: 5
          step: 0.1
          unit_of_measurement: s

mode: parallel
max: 50
max_exceeded: silent

trigger:
  - domain: mqtt
    device_id: !input mqtt_device
    type: action
    subtype: button_1_press
    trigger: device
    id: button_1

  - domain: mqtt
    device_id: !input mqtt_device
    type: action
    subtype: button_2_press
    trigger: device
    id: button_2

  - domain: mqtt
    device_id: !input mqtt_device
    type: action
    subtype: button_3_press
    trigger: device
    id: button_3

  - domain: mqtt
    device_id: !input mqtt_device
    type: action
    subtype: button_4_press
    trigger: device
    id: button_4

  - domain: mqtt
    device_id: !input mqtt_device
    type: action
    subtype: brightness_step_down
    trigger: device
    id: down

  - domain: mqtt
    device_id: !input mqtt_device
    type: action
    subtype: brightness_step_up
    trigger: device
    id: up

action:
  - choose:
      - conditions:
          - condition: trigger
            id: button_1
        sequence:
          - service: light.toggle
            target:
              entity_id: !input light_target
            data:
              transition: !input transition_time

      - conditions:
          - condition: trigger
            id: button_2
        sequence: !input button_2_press

      - conditions:
          - condition: trigger
            id: button_3
        sequence: !input button_3_press

      - conditions:
          - condition: trigger
            id: button_4
        sequence: !input button_4_press

      - conditions:
          - condition: trigger
            id: down
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input light_target
            data:
              brightness_step_pct: -15
              transition: !input transition_time

      - conditions:
          - condition: trigger
            id: up
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input light_target
            data:
              brightness_step_pct: 15
              transition: !input transition_time
