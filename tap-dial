blueprint:
  name: MQTT Button â€“ Lights, Cover & Switch
  description: >
    Control a light, cover and switch using an MQTT button device.
    Button 1 toggles light, Button 2 toggles cover, Button 3 toggles switch,
    brightness up/down controls light brightness.
  domain: automation

  input:
    mqtt_device:
      name: MQTT Button Device
      description: The MQTT device that sends button actions
      selector:
        device:
          integration: mqtt

    light_target:
      name: Light
      selector:
        entity:
          domain: light

    cover_target:
      name: Cover
      selector:
        entity:
          domain: cover

    switch_target:
      name: Switch
      selector:
        entity:
          domain: switch

    brightness_step:
      name: Brightness step (%)
      description: Percentage step for brightness up/down
      default: 15
      selector:
        number:
          min: 1
          max: 50
          unit_of_measurement: "%"

    transition_time:
      name: Light transition time (seconds)
      default: 0.5
      selector:
        number:
          min: 0
          max: 5
          step: 0.1
          unit_of_measurement: s

mode: parallel
max: 50
max_exceeded: silent

trigger:
  - domain: mqtt
    device_id: !input mqtt_device
    type: action
    subtype: button_1_press
    trigger: device
    id: button_1

  - domain: mqtt
    device_id: !input mqtt_device
    type: action
    subtype: brightness_step_down
    trigger: device
    id: button_2

  - domain: mqtt
    device_id: !input mqtt_device
    type: action
    subtype: brightness_step_down
    trigger: device
    id: button_3

  - domain: mqtt
    device_id: !input mqtt_device
    type: action
    subtype: button_4_press
    trigger: device
    id: button_4

  - domain: mqtt
    device_id: !input mqtt_device
    type: action
    subtype: brightness_step_down
    trigger: device
    id: down

  - domain: mqtt
    device_id: !input mqtt_device
    type: action
    subtype: brightness_step_up
    trigger: device
    id: up

action:
  - choose:
      - conditions:
          - condition: trigger
            id: button_1
        sequence:
          - service: light.toggle
            target:
              entity_id: !input light_target
            data:
              transition: !input transition_time

      - conditions:
          - condition: trigger
            id: button_2
        sequence:
          - service: cover.toggle
            target:
              entity_id: !input cover_target

      - conditions:
          - condition: trigger
            id: button_3
        sequence:
          - service: switch.toggle
            target:
              entity_id: !input switch_target

      - conditions:
          - condition: trigger
            id: down
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input light_target
            data:
              brightness_step_pct: "{{ -1 * (brightness_step | int) }}"
              transition: !input transition_time

      - conditions:
          - condition: trigger
            id: up
        sequence:
          - service: light.turn_on
            target:
              entity_id: !input light_target
            data:
              brightness_step_pct: !input brightness_step
              transition: !input transition_time
